<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Dubai:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --primary: #0a84ff;
            --danger: #ff453a;
            --success: #32d74b;
            --gold: #ffd700;
        }

        body { 
            font-family: 'Dubai', sans-serif; 
            background: #000;
            background-image: radial-gradient(circle at 50% 0%, #1c1c1e 0%, #000 100%);
            color: #fff;
            margin: 0; padding: 15px;
            display: flex; justify-content: center;
            min-height: 100vh;
        }

        .app-container { width: 100%; max-width: 480px; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
        }

        /* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠØ© */
        input {
            width: 100%; padding: 15px; margin: 10px 0;
            border-radius: 15px; border: 1px solid var(--glass-border);
            font-size: 18px; box-sizing: border-box;
            background: rgba(0, 0, 0, 0.5); color: #fff;
            font-family: Arial, sans-serif; /* Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠØ© */
            text-align: center;
            direction: ltr; /* Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ */
        }

        button {
            width: 100%; padding: 16px; border-radius: 15px; border: none;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
            margin: 8px 0; font-family: 'Dubai'; transition: 0.2s;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--glass-border); color: white; }

        .team-label { color: var(--primary); font-weight: bold; margin-bottom: 5px; display: block; }
        
        .score-box {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.03); padding: 10px; border-radius: 15px; margin-bottom: 10px;
        }

        .total-display {
            text-align: center; padding: 15px; border-radius: 18px;
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
        }

        .leader { border-color: var(--danger); background: rgba(255, 69, 58, 0.15); }
        .leader .num { color: var(--danger); font-size: 2em; font-weight: 900; }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± */
        .round-record {
            border-left: 3px solid var(--primary);
            padding: 10px 15px; margin-bottom: 20px;
            background: rgba(255,255,255,0.02); border-radius: 0 15px 15px 0;
        }

        .history-table { width: 100%; border-collapse: collapse; font-size: 0.8em; margin-top: 10px; }
        .history-table th { text-align: right; color: #888; border-bottom: 1px solid var(--glass-border); padding: 5px; }
        .history-table td { padding: 8px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .badge-win { background: var(--success); padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="scr_welcome" class="glass-card">
        <h2 style="text-align:center">ğŸ€„ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</h2>
        <p style="text-align:center; opacity:0.6;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ø£Ø´ÙˆØ§Ø·</p>
        <button class="btn-primary" onclick="navTo('scr_setup')">Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <div id="scr_setup" class="glass-card" style="display:none;">
        <h3>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ†</h3>
        <span class="team-label">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</span>
        <input type="text" id="t1_name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚">
        <div style="display:flex; gap:10px;">
            <input type="text" id="t1_p1" placeholder="Ø§Ù„Ù„Ø§Ø¹Ø¨ 1">
            <input type="text" id="t1_p2" placeholder="Ø§Ù„Ù„Ø§Ø¹Ø¨ 2">
        </div>
        <span class="team-label">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</span>
        <input type="text" id="t2_name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚">
        <div style="display:flex; gap:10px;">
            <input type="text" id="t2_p1" placeholder="Ø§Ù„Ù„Ø§Ø¹Ø¨ 3">
            <input type="text" id="t2_p2" placeholder="Ø§Ù„Ù„Ø§Ø¹Ø¨ 4">
        </div>
        <button class="btn-primary" onclick="initSession()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
    </div>

    <div id="scr_game" class="glass-card" style="display:none;">
        <div style="text-align:center; margin-bottom:15px;">
            <span style="background:var(--primary); padding:4px 12px; border-radius:20px; font-size:0.8em;">Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="round_num">1</span></span>
        </div>

        <div id="ui_t1">
            <h4 id="head_t1" style="margin:0 0 10px 0;"></h4>
            <div class="score-box">
                <span id="label_p1"></span>
                <input type="number" inputmode="numeric" id="in_p1" style="width:80px; margin:0;">
            </div>
            <div class="score-box">
                <span id="label_p2"></span>
                <input type="number" inputmode="numeric" id="in_p2" style="width:80px; margin:0;">
            </div>
            <div id="card_t1" class="total-display">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total_t1" class="num">0</span></div>
        </div>

        <hr style="opacity:0.1; margin:20px 0;">

        <div id="ui_t2">
            <h4 id="head_t2" style="margin:0 0 10px 0;"></h4>
            <div class="score-box">
                <span id="label_p3"></span>
                <input type="number" inputmode="numeric" id="in_p3" style="width:80px; margin:0;">
            </div>
            <div class="score-box">
                <span id="label_p4"></span>
                <input type="number" inputmode="numeric" id="in_p4" style="width:80px; margin:0;">
            </div>
            <div id="card_t2" class="total-display">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total_t2" class="num">0</span></div>
        </div>

        <button class="btn-success" style="margin-top:20px;" onclick="addPoints()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
    </div>

    <div id="scr_report" style="display:none;">
        <div id="capture_area" style="background:#000; padding:20px;">
            <div class="glass-card" style="border:none; background:rgba(255,255,255,0.05);">
                <h2 style="margin:0">Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„ÙƒØ§Ù…Ù„</h2>
                <p id="session_date" style="font-size:0.8em; opacity:0.5;"></p>
                <div id="session_stats" style="margin:20px 0; border-top:1px solid var(--glass-border); padding-top:10px;"></div>
                
                <div id="all_rounds_history"></div>
                
                <p style="text-align:center; font-size:0.7em; color:var(--primary); margin-top:20px;">ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø£Ù…ÙŠÙ† Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</p>
            </div>
        </div>
        
        <div class="glass-card">
            <button class="btn-success" onclick="saveImage()">â¬‡ï¸ Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù„Ø³Ø© ÙƒØµÙˆØ±Ø©</button>
            <button class="btn-primary" onclick="startNextRound()">ğŸ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø´ÙˆØ· Ø§Ù„ØªØ§Ù„ÙŠ</button>
            <button class="btn-outline" style="color:var(--danger); border-color:var(--danger);" onclick="location.reload()">ğŸ”„ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
    </div>
</div>

<script>
    let session = {
        currentRound: 1,
        teams: {
            t1: { name: "", p: ["", ""], wins: 0 },
            t2: { name: "", p: ["", ""], wins: 0 }
        },
        roundsHistory: [] // Ø³ÙŠØ®Ø²Ù† Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø´ÙˆØ· ÙŠÙ†ØªÙ‡ÙŠ
    };

    let currentRoundData = {
        t1Score: 0, t2Score: 0,
        pScores: [0,0,0,0],
        logs: []
    };

    function navTo(id) {
        document.querySelectorAll('.app-container > div').forEach(d => d.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function initSession() {
        session.teams.t1.name = document.getElementById('t1_name').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 1";
        session.teams.t1.p = [document.getElementById('t1_p1').value || "Ù„Ø§Ø¹Ø¨ 1", document.getElementById('t1_p2').value || "Ù„Ø§Ø¹Ø¨ 2"];
        session.teams.t2.name = document.getElementById('t2_name').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 2";
        session.teams.t2.p = [document.getElementById('t2_p1').value || "Ù„Ø§Ø¹Ø¨ 3", document.getElementById('t2_p2').value || "Ù„Ø§Ø¹Ø¨ 4"];
        
        setupGameUI();
        navTo('scr_game');
    }

    function setupGameUI() {
        document.getElementById('round_num').innerText = session.currentRound;
        document.getElementById('head_t1').innerText = session.teams.t1.name;
        document.getElementById('label_p1').innerText = session.teams.t1.p[0];
        document.getElementById('label_p2').innerText = session.teams.t1.p[1];
        
        document.getElementById('head_t2').innerText = session.teams.t2.name;
        document.getElementById('label_p3').innerText = session.teams.t2.p[0];
        document.getElementById('label_p4').innerText = session.teams.t2.p[1];
        
        resetRoundInputs();
    }

    function addPoints() {
        let inputs = [
            Number(document.getElementById('in_p1').value) || 0,
            Number(document.getElementById('in_p2').value) || 0,
            Number(document.getElementById('in_p3').value) || 0,
            Number(document.getElementById('in_p4').value) || 0
        ];

        let time = new Date().toLocaleTimeString("en-US", {hour12:false, minute:'2-digit', second:'2-digit'});

        inputs.forEach((v, i) => {
            if(v > 0) {
                let pName = i < 2 ? session.teams.t1.p[i] : session.teams.t2.p[i-2];
                currentRoundData.logs.push({ name: pName, val: v, time: time });
                currentRoundData.pScores[i] += v;
                if(i < 2) currentRoundData.t1Score += v;
                else currentRoundData.t2Score += v;
            }
        });

        updateScoresDisplay();
        for(let i=1; i<=4; i++) document.getElementById('in_p'+i).value = "";

        if(currentRoundData.t1Score >= 151 || currentRoundData.t2Score >= 151) {
            finishRound();
        }
    }

    function updateScoresDisplay() {
        document.getElementById('total_t1').innerText = currentRoundData.t1Score;
        document.getElementById('total_t2').innerText = currentRoundData.t2Score;

        const c1 = document.getElementById('card_t1');
        const c2 = document.getElementById('card_t2');
        c1.classList.remove('leader'); c2.classList.remove('leader');

        if(currentRoundData.t1Score > currentRoundData.t2Score) c1.classList.add('leader');
        else if(currentRoundData.t2Score > currentRoundData.t1Score) c2.classList.add('leader');
    }

    function finishRound() {
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙˆØ· ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
        let winner = currentRoundData.t1Score >= 151 ? session.teams.t1.name : session.teams.t2.name;
        if(currentRoundData.t1Score >= 151) session.teams.t1.wins++; else session.teams.t2.wins++;

        session.roundsHistory.push({
            roundNum: session.currentRound,
            t1Final: currentRoundData.t1Score,
            t2Final: currentRoundData.t2Score,
            winner: winner,
            logs: [...currentRoundData.logs]
        });

        showFinalReport();
    }

    function showFinalReport() {
        document.getElementById('session_date').innerText = "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©: " + new Date().toLocaleString("ar-EG");
        
        // Ù…Ù„Ø®Øµ Ø§Ù„ÙÙˆØ²
        document.getElementById('session_stats').innerHTML = `
            <div style="display:flex; justify-content:space-around; text-align:center;">
                <div><small>${session.teams.t1.name}</small><br><b style="font-size:1.5em; color:var(--primary)">${session.teams.t1.wins} ÙÙˆØ²</b></div>
                <div style="font-size:1.5em; opacity:0.2">|</div>
                <div><small>${session.teams.t2.name}</small><br><b style="font-size:1.5em; color:var(--primary)">${session.teams.t2.wins} ÙÙˆØ²</b></div>
            </div>
        `;

        // Ø³Ø¬Ù„ Ø§Ù„Ø£Ø´ÙˆØ§Ø·
        let html = "";
        session.roundsHistory.forEach(r => {
            html += `
                <div class="round-record">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b>Ø§Ù„Ø´ÙˆØ· ${r.roundNum}</b>
                        <span class="badge-win">Ø§Ù„ÙØ§Ø¦Ø²: ${r.winner}</span>
                    </div>
                    <div style="font-size:0.9em; margin:5px 0;">Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${r.t1Final} - ${r.t2Final}</div>
                    <table class="history-table">
                        <tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ù†Ù‚Ø·Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr>
                        ${r.logs.map(l => `<tr><td>${l.name}</td><td>${l.val}</td><td>${l.time}</td></tr>`).join('')}
                    </table>
                </div>
            `;
        });
        document.getElementById('all_rounds_history').innerHTML = html;
        navTo('scr_report');
    }

    function startNextRound() {
        session.currentRound++;
        currentRoundData = { t1Score: 0, t2Score: 0, pScores: [0,0,0,0], logs: [] };
        setupGameUI();
        updateScoresDisplay();
        navTo('scr_game');
    }

    function resetRoundInputs() {
        for(let i=1; i<=4; i++) document.getElementById('in_p'+i).value = "";
    }

    function saveImage() {
        const area = document.getElementById('capture_area');
        html2canvas(area, { scale: 3, backgroundColor: '#000000' }).then(canvas => {
            const link = document.createElement('a');
            link.download = `Dominos_Session_${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Dubai:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.12);
            --primary: #0a84ff;
            --danger: #ff453a;
            --success: #32d74b;
            --gold: #ffd700;
            --warning: #ff9f0a;
        }

        body { 
            font-family: 'Dubai', sans-serif; 
            background: #000;
            background-image: radial-gradient(circle at 50% 0%, #1c1c1e 0%, #000 100%);
            color: #fff;
            margin: 0; padding: 15px;
            display: flex; justify-content: center;
            min-height: 100vh;
        }

        .app-container { width: 100%; max-width: 480px; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
        }

        .important-note {
            background: rgba(255, 159, 10, 0.1);
            border: 1px solid var(--warning);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9em;
            line-height: 1.6;
            color: var(--warning);
            text-align: justify;
        }

        input {
            width: 100%; padding: 15px; margin: 10px 0;
            border-radius: 15px; border: 1px solid var(--glass-border);
            font-size: 20px; box-sizing: border-box;
            background: rgba(0, 0, 0, 0.6); color: #fff;
            font-family: Arial, Helvetica, sans-serif; 
            text-align: center; direction: ltr;
        }

        button {
            width: 100%; padding: 16px; border-radius: 15px; border: none;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
            margin: 8px 0; font-family: 'Dubai'; transition: 0.2s;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--glass-border); color: white; }

        .total-display {
            text-align: center; padding: 15px; border-radius: 18px;
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
        }

        .leader { border-color: var(--danger); background: rgba(255, 69, 58, 0.15); }
        .leader .num { color: var(--danger); font-size: 2.2em; font-weight: 900; }

        .award-card {
            text-align: center; padding: 15px; border-radius: 20px; margin: 10px 0;
            border: 1px solid var(--glass-border);
        }
        .mvp { background: rgba(255, 215, 0, 0.1); border-color: var(--gold); }
        .noob { background: rgba(255, 69, 58, 0.1); border-color: var(--danger); }

        .round-record {
            border-right: 4px solid var(--primary);
            padding: 10px 15px; margin-bottom: 20px;
            background: rgba(255,255,255,0.02); border-radius: 15px 0 0 15px;
        }

        .history-table { width: 100%; border-collapse: collapse; font-size: 0.85em; margin-top: 10px; }
        .history-table th { text-align: right; color: #888; border-bottom: 1px solid var(--glass-border); padding: 5px; }
        .history-table td { padding: 8px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body>

<div class="app-container">
    <div id="scr_welcome" class="glass-card">
        <h2 style="text-align:center">ğŸ€„ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</h2>
        
        <div class="important-note">
            <b>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:</b><br>
            Ø§Ù† Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ù‡ÙŠ Ù„Ù„ØªØ³Ù„ÙŠØ© ÙˆÙ„ÙŠØ³Øª Ù„Ù„Ø¹ØµØ¨ÙŠØ© ÙˆØ§Ù„Ø³Ø¨ ÙˆØ§Ù„Ø´ØªÙ… Ø§Ù†ØªÙ‚ÙˆØ§ Ø§Ù„ÙØ§Ø¸ÙƒÙ… ÙˆØ§Ù„Ø¹Ø¨ÙˆØ§ Ø¨Ø±ÙˆØ­ Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ø°Ø§ Ø®Ø³Ø±Øª Ù…Ø±Ø§Ø­ ØªÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¯Ù†ÙŠØ§ ÙˆØ§Ø°Ø§ ÙØ²Øª Ù„Ø§ ØªÙØ±Ø­ Ø­ÙŠÙ„ Ø¨Ø§Ø¬Ø± ØªØ®Ø³Ø± ÙˆØ§Ø°Ø§ Ø¹Ù†Ø¯Ùƒ Ø´ØºÙ„ Ø¹ÙˆÙ Ø§Ù„Ø¯ÙˆÙ…Ù†Ø§ ÙˆÙƒÙˆÙ… ÙƒÙ…Ù„ Ø´ØºÙ„Ùƒ Ø§Ø­Ø³Ù† ÙˆØ§Ø°Ø§ ÙØ§Ø¶ÙŠ Ø­Ø¶Ø± Ø§Ù„Ù†Ø±ÙƒÙŠÙ„Ø© ÙŠÙ…Ùƒ ÙˆØ¬ÙŠØ¨ Ø§Ù„ÙˆØ§Ø¹ÙŠØ¨ Ø§Ù„ÙŠ ÙŠØ¹Ø±ÙÙˆÙ† ÙˆØ§Ù„ÙŠ Ù…Ø§ ÙŠØ¹Ø±Ù Ø®Ù„ ÙŠÙƒØ¹Ø¯ ÙŠØªÙØ±Ø¬ ÙˆØ§Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙŠ ØªØ®Ø³Ø± ÙˆÙŠØ§ Ù„Ø§ ØªÙ„Ø¹Ø¨ ÙˆÙŠØ§ Ø¨Ø¹Ø¯ Ù„Ø§Ù† Ø§Ø«ÙˆÙ„ Ù…Ø§ ÙŠÙÙŠØ¯ ÙˆØ¨Ø³ ÙŠØ±ÙØ¹ Ø§Ù„Ø³ÙƒØ± ÙˆÙ„Ø§ ØªÙ„Ø¹Ø¨ Ø¶Ø¯ ÙØ±ÙŠÙ‚ Ù…ÙŠØ¹Ø±ÙÙˆÙ† ÙŠÙ„Ø¹Ø¨ÙˆÙ† Ù„Ø§Ù† Ø±Ø§Ø­ ÙŠØ®Ø®Ø¯Ø¹ÙˆÙƒ Ø¨ØºØ´Ø§Ù…ØªÙ‡Ù….
        </div>

        <button class="btn-primary" onclick="navTo('scr_setup')">Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <div id="scr_setup" class="glass-card" style="display:none;">
        <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ†</h3>
        <input type="text" id="t1_name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 1">
        <div style="display:flex; gap:10px;">
            <input type="text" id="t1_p1" placeholder="Ù„Ø§Ø¹Ø¨ 1">
            <input type="text" id="t1_p2" placeholder="Ù„Ø§Ø¹Ø¨ 2">
        </div>
        <hr style="opacity:0.1; margin:15px 0;">
        <input type="text" id="t2_name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 2">
        <div style="display:flex; gap:10px;">
            <input type="text" id="t2_p1" placeholder="Ù„Ø§Ø¹Ø¨ 3">
            <input type="text" id="t2_p2" placeholder="Ù„Ø§Ø¹Ø¨ 4">
        </div>
        <button class="btn-primary" onclick="initSession()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
    </div>

    <div id="scr_game" class="glass-card" style="display:none;">
        <div style="text-align:center; margin-bottom:15px;">
            <span style="background:var(--primary); padding:4px 15px; border-radius:20px; font-size:0.9em;">Ø´ÙˆØ· Ø±Ù‚Ù…: <span id="round_num">1</span></span>
        </div>

        <div id="ui_t1">
            <h4 id="head_t1" style="margin:0 0 10px 0; color:var(--primary)"></h4>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div><span id="label_p1"></span>: <b id="p1_total" style="color:var(--success)">0</b></div>
                <input type="number" inputmode="numeric" id="in_p1" style="width:70px; margin:0; padding:8px;">
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div><span id="label_p2"></span>: <b id="p2_total" style="color:var(--success)">0</b></div>
                <input type="number" inputmode="numeric" id="in_p2" style="width:70px; margin:0; padding:8px;">
            </div>
            <div id="card_t1" class="total-display">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total_t1" class="num">0</span></div>
        </div>

        <hr style="opacity:0.1; margin:20px 0;">

        <div id="ui_t2">
            <h4 id="head_t2" style="margin:0 0 10px 0; color:var(--primary)"></h4>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div><span id="label_p3"></span>: <b id="p3_total" style="color:var(--success)">0</b></div>
                <input type="number" inputmode="numeric" id="in_p3" style="width:70px; margin:0; padding:8px;">
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div><span id="label_p4"></span>: <b id="p4_total" style="color:var(--success)">0</b></div>
                <input type="number" inputmode="numeric" id="in_p4" style="width:70px; margin:0; padding:8px;">
            </div>
            <div id="card_t2" class="total-display">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total_t2" class="num">0</span></div>
        </div>

        <button class="btn-success" style="margin-top:20px;" onclick="addPoints()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
    </div>

    <div id="scr_report" style="display:none;">
        <div id="capture_area" style="background:#000; padding:20px;">
            <h2 style="text-align:center; margin-bottom:5px;">ğŸ† Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
            <p id="session_meta" style="text-align:center; font-size:0.8em; opacity:0.5; margin-bottom:20px;"></p>
            
            <div id="awards_section"></div>

            <div id="all_rounds_history"></div>
            
            <p style="text-align:center; font-size:0.7em; color:var(--primary); margin-top:30px;">ØªØ·Ø¨ÙŠÙ‚ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ â€¢ Ù…. Ø£Ù…ÙŠÙ† Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</p>
        </div>
        
        <div class="glass-card">
            <button class="btn-success" onclick="saveImage()">ğŸ“¸ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø§Ù„ØµÙˆØ±</button>
            <button class="btn-primary" onclick="startNextRound()">ğŸ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø´ÙˆØ· Ø§Ù„ØªØ§Ù„ÙŠ</button>
            <button class="btn-outline" style="color:var(--danger); border-color:var(--danger);" onclick="location.reload()">ğŸ”„ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
    </div>
</div>

<script>
    let session = {
        round: 1,
        teams: { t1: { n: "", p: [], w: 0 }, t2: { n: "", p: [], w: 0 } },
        history: [],
        playerTotals: {} 
    };

    let roundData = { t1S: 0, t2S: 0, logs: [] };

    const winTitles = ["Ø²ÙˆØ±ÙŠ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©", "Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ù„ÙƒÙŠ", "ÙƒØ§Ø³Ø± Ø§Ù„Ø®Ø´ÙˆÙ…", "Ø§Ù„Ù…Ù†Ù‚Ø°", "Ø§Ù„Ø­Ø±ÙŠÙ", "Ø£Ø³Ø¯ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ"];
    const loseTitles = ["Ø£Ø¨Ùˆ Ø¨Ù„Ø§Ø´", "Ù…ÙˆØ²Ø¹ Ù‡Ø¯Ø§ÙŠØ§", "Ø®ÙˆØ´ ÙˆÙ„Ø¯", "Ø¹Ø´Ø§ÙŠ Ø§Ù„Ø¹ØµØ§ÙÙŠØ±", "Ø§Ù„ØºØ´ÙŠÙ…", "ØµØ§Ù†Ø¹ Ø§Ù„ÙØ±Ø­Ø© Ù„ØºÙŠØ±Ù‡"];

    function navTo(id) {
        document.querySelectorAll('.app-container > div').forEach(d => d.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function initSession() {
        session.teams.t1.n = document.getElementById('t1_name').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 1";
        session.teams.t1.p = [document.getElementById('t1_p1').value || "Ù„Ø§Ø¹Ø¨ 1", document.getElementById('t1_p2').value || "Ù„Ø§Ø¹Ø¨ 2"];
        session.teams.t2.n = document.getElementById('t2_name').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 2";
        session.teams.t2.p = [document.getElementById('t2_p1').value || "Ù„Ø§Ø¹Ø¨ 3", document.getElementById('t2_p2').value || "Ù„Ø§Ø¹Ø¨ 4"];
        
        [...session.teams.t1.p, ...session.teams.t2.p].forEach(name => session.playerTotals[name] = 0);
        
        updateGameUI();
        navTo('scr_game');
    }

    function addPoints() {
        let ins = [
            Number(document.getElementById('in_p1').value) || 0,
            Number(document.getElementById('in_p2').value) || 0,
            Number(document.getElementById('in_p3').value) || 0,
            Number(document.getElementById('in_p4').value) || 0
        ];

        let time = new Date().toLocaleTimeString("en-US", {hour12:false, minute:'2-digit', second:'2-digit'});

        ins.forEach((v, i) => {
            if(v > 0) {
                let pName = i < 2 ? session.teams.t1.p[i] : session.teams.t2.p[i-2];
                roundData.logs.push({ name: pName, val: v, time: time });
                session.playerTotals[pName] += v;
                if(i < 2) roundData.t1S += v; else roundData.t2S += v;
            }
        });

        updateGameUI();
        if(roundData.t1S >= 151 || roundData.t2S >= 151) finishRound();
    }

    function updateGameUI() {
        document.getElementById('round_num').innerText = session.round;
        document.getElementById('head_t1').innerText = session.teams.t1.n;
        document.getElementById('label_p1').innerText = session.teams.t1.p[0];
        document.getElementById('label_p2').innerText = session.teams.t1.p[1];
        document.getElementById('p1_total').innerText = session.playerTotals[session.teams.t1.p[0]];
        document.getElementById('p2_total').innerText = session.playerTotals[session.teams.t1.p[1]];
        document.getElementById('total_t1').innerText = roundData.t1S;

        document.getElementById('head_t2').innerText = session.teams.t2.n;
        document.getElementById('label_p3').innerText = session.teams.t2.p[0];
        document.getElementById('label_p4').innerText = session.teams.t2.p[1];
        document.getElementById('p3_total').innerText = session.playerTotals[session.teams.t2.p[0]];
        document.getElementById('p4_total').innerText = session.playerTotals[session.teams.t2.p[1]];
        document.getElementById('total_t2').innerText = roundData.t2S;

        const c1 = document.getElementById('card_t1'); const c2 = document.getElementById('card_t2');
        c1.classList.remove('leader'); c2.classList.remove('leader');
        if(roundData.t1S > roundData.t2S) c1.classList.add('leader'); else if(roundData.t2S > roundData.t1S) c2.classList.add('leader');

        for(let i=1; i<=4; i++) document.getElementById('in_p'+i).value = "";
    }

    function finishRound() {
        let winner = roundData.t1S >= 151 ? session.teams.t1.n : session.teams.t2.n;
        if(roundData.t1S >= 151) session.teams.t1.w++; else session.teams.t2.w++;

        session.history.push({
            num: session.round,
            t1F: roundData.t1S, t2F: roundData.t2S,
            win: winner, logs: [...roundData.logs]
        });

        showReport();
    }

    function showReport() {
        document.getElementById('session_meta').innerText = "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©: " + new Date().toLocaleString("ar-EG");
        
        let players = Object.keys(session.playerTotals);
        let mvp = players.reduce((a, b) => session.playerTotals[a] > session.playerTotals[b] ? a : b);
        let noob = players.reduce((a, b) => session.playerTotals[a] < session.playerTotals[b] ? a : b);

        let vTitle = winTitles[Math.floor(Math.random() * winTitles.length)];
        let lTitle = loseTitles[Math.floor(Math.random() * loseTitles.length)];

        document.getElementById('awards_section').innerHTML = `
            <div class="award-card mvp">
                <div style="font-size:1.5em">ğŸŒŸ Ù†Ø¬Ù… Ø§Ù„Ø¬Ù„Ø³Ø© ğŸŒŸ</div>
                <div style="font-size:1.8em; font-weight:bold;">${mvp}</div>
                <div style="color:var(--gold)">Ø§Ù„Ù„Ù‚Ø¨: ${vTitle} | Ø§Ù„Ù†Ù‚Ø§Ø·: ${session.playerTotals[mvp]}</div>
            </div>
            <div class="award-card noob">
                <div style="font-size:1.2em">ğŸ“‰ Ø£ÙØ´Ù„ Ù„Ø§Ø¹Ø¨ ğŸ“‰</div>
                <div style="font-size:1.5em; font-weight:bold;">${noob}</div>
                <div style="color:var(--danger)">Ø§Ù„Ù„Ù‚Ø¨: ${lTitle} | Ø§Ù„Ù†Ù‚Ø§Ø·: ${session.playerTotals[noob]}</div>
            </div>
            <div style="display:flex; justify-content:space-around; margin:20px 0; border-bottom:1px solid var(--glass-border); padding-bottom:15px;">
                <div><small>${session.teams.t1.n}</small><br><b>${session.teams.t1.w} ÙÙˆØ²</b></div>
                <div style="font-size:1.5em; opacity:0.2">VS</div>
                <div><small>${session.teams.t2.n}</small><br><b>${session.teams.t2.w} ÙÙˆØ²</b></div>
            </div>
        `;

        let hHtml = "";
        // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ù…Ù† 1 Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø®ÙŠØ±)
        session.history.forEach(r => {
            hHtml += `
                <div class="round-record">
                    <div style="display:flex; justify-content:space-between;"><b>Ø§Ù„Ø´ÙˆØ· ${r.num}</b> <span style="color:var(--success)">Ø§Ù„ÙØ§Ø¦Ø²: ${r.win}</span></div>
                    <div style="font-size:0.8em; opacity:0.7">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${r.t1F} - ${r.t2F}</div>
                    <table class="history-table">
                        <tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ù†Ù‚Ø·Ø©</th><th>ÙˆÙ‚Øª</th></tr>
                        ${r.logs.map(l => `<tr><td>${l.name}</td><td>${l.val}</td><td>${l.time}</td></tr>`).join('')}
                    </table>
                </div>
            `;
        });
        document.getElementById('all_rounds_history').innerHTML = hHtml;
        navTo('scr_report');
    }

    function startNextRound() {
        session.round++;
        roundData = { t1S: 0, t2S: 0, logs: [] };
        updateGameUI();
        navTo('scr_game');
    }

    function saveImage() {
        const area = document.getElementById('capture_area');
        html2canvas(area, { scale: 3, backgroundColor: '#000000' }).then(canvas => {
            const link = document.createElement('a');
            link.download = `ØªÙ‚Ø±ÙŠØ±_Ø¯ÙˆÙ…ÙŠÙ†Ùˆ_${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>

</body>
</html>
